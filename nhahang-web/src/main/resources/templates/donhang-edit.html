<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sửa Đơn hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .form-section { background-color: #ffffff; border-radius: 15px; padding: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); max-width: 1000px; margin: auto; }
        h2 { text-align: center; color: #212529; margin-bottom: 25px; font-weight: bold; }
        .form-label { font-weight: 600; color: #212529; }
        .btn-dark { background-color: #212529; border: none; }
        .btn-dark:hover { background-color: #1a1e21; }
    </style>
</head>
<body class="container py-4">

<div class="form-section">
    <h2><i class="fas fa-pen-to-square"></i> Cập nhật Đơn hàng</h2>
    <form th:action="@{/donhang/update}" method="post" th:object="${donhang}" class="row g-4">
        <input type="hidden" th:field="*{id}" />

        <div class="col-md-3">
            <label class="form-label">Mã đơn hàng</label>
            <input type="text" th:field="*{maDH}" class="form-control" readonly />
        </div>

        <!-- Chỉnh sửa nhiều bàn (bàn chính + phụ) -->
        <div class="col-md-4">
            <label class="form-label">Bàn (có thể chọn nhiều)</label>
            <select name="idBans" multiple class="form-select" required>
                <!-- chọn nếu là bàn chính hiện tại hoặc nằm trong bansPhu -->
                <option th:each="b : ${bans}"
                        th:value="${b.id}"
                        th:text="${b.tenBan}"
                        th:selected="${(donhang.ban != null and b.id == donhang.ban.id) or (donhang.bansPhu != null and #lists.contains(donhang.bansPhu, b))}"
                        th:if="${b.trangThai == 'TRONG' or (donhang.ban != null and b.id == donhang.ban.id) or (donhang.bansPhu != null and #lists.contains(donhang.bansPhu, b))}">
                </option>
            </select>
            <small class="text-muted">Giữ Ctrl (hoặc Command) để chọn nhiều bàn</small>
        </div>

        <div class="col-md-4">
            <label class="form-label">Khách hàng</label>
            <select th:field="*{khachHang.id}" class="form-select" required>
                <option th:each="k : ${khachhangs}" th:value="${k.id}" th:text="${k.tenKH}"></option>
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label">Nhân viên</label>
            <select th:field="*{nhanVien.id}" class="form-select" required>
                <option th:each="n : ${nhanviens}" th:value="${n.id}" th:text="${n.tenNV}"></option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Ngày tạo</label>
            <input type="text" th:value="${#dates.format(donhang.ngayTao,'dd/MM/yyyy')}" class="form-control" readonly />
        </div>

        <div class="col-md-3">
            <label class="form-label">Tổng tiền</label>
            <input type="number" th:field="*{tongTien}" class="form-control" readonly />
        </div>

        <div class="col-md-3">
            <label class="form-label">Trạng thái</label>
            <input type="text" class="form-control"
                   th:value="${donhang.trangThai == T(com.nhahang.nhahang_web.model.DonHang.TrangThaiDonHang).DANG_XU_LY ? 'Đang xử lý' : 'Đã thanh toán'}"
                   readonly />
        </div>

        <div class="col-12 d-flex justify-content-between">
            <a href="/donhang" class="btn btn-outline-dark"><i class="fas fa-arrow-left"></i> Hủy</a>
            <button type="submit" class="btn btn-dark"><i class="fas fa-save"></i> Lưu</button>
        </div>
    </form>
</div>

</body>
</html>
